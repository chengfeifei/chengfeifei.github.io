---
layout: post
title: 行践自行车项目接口需求
date: 2016-10-14
categories: work
tags: [接口需求]
---

 版本  | 修订内容                  | 修订日期    |
------|--------------------------|------------|
 V1.0 | 用户App、员工App接口参数描述 | 2016-10-14 |
 V1.1 | 地图－附近站点状态判断规则修改 | 2016-10-17 |
 V1.2 | 用户App接口需求开发人员确认 | 2016-10-17 |
 V1.3 | 字段补充 | 2016-10-19 |
 V1.4 | 骑行卡说明、管理人员字段补充 | 2016-10-20 |
 V1.5 | 计费说明 | 2016-10-21 |
 V1.6 | 调度算法说明、获取用户信息接口修改 | 2016-10-25 |

>所有接口均返回状态码，表示请求成功或请求失败，失败状态码定义多种错误类型。
>
>参数标记可空的为可空参数，未标记的为非空参数。
>
>时间格式在App中变化较多，建议后台返回long型时间，App做格式处理。
>
>此文档提到的字段是根据前端业务需求需要特别指明的字段，并不是这个接口只含有这几个字段。

### 调度算法说明（新增：V1.6）

需要考虑合理配置资源，如果好几个附近站点都需要调度，就批量下发这几个站点的调度任务。不能让调度人员只为了几个车就跑一趟。

地理位置影响因素：市中心区域早高峰调出需求大，晚高峰调入需求大；郊区早高峰调入需求大，晚高峰调出需求大。

用车高峰、还车高峰判断说明：高分时刻用车数大于还车数则为用车高峰，反之则为还车高峰。

位置权重说明：外环权重比内环低，权重值可以按到市中心距离算。位置权重范围：0.1～2。

**举例如下：**

假设站点A（五环外），可借车和可还锁桩各15、预警值为80%、位置权重0.5。根据每日借车量、还车量，以中午12点为分割点，计算出早晚用车高峰、还车高峰。

调入情况举例：如果计算出的早高峰在8时～9时（假设是用车高峰），此时间段可借车辆最少时为8辆（低于预警值：15*80%＝12），后台算法得出此站点在8时～9时需调入车辆2辆｛（12-8）＊0.5＝2｝。

调出情况举例：如果计算出的晚高峰在18时～19时（假设是还车高峰），此时间段可还锁桩最少时为8个（低于预警值：15*80%＝12），后台算法得出此站点在18时～19时需调出车辆2辆｛（12-8）＊0.5＝2｝。

---

### 两种骑行卡特点（新增：V1.4）

**普通骑行卡：**

* 属于银行卡（有身份信息）
* 付费租车
* 使用App有计费、有提醒、有推送
* 绑卡页面字段：真实姓名、身份证号、骑行卡号、预留手机号、短信验证码

**VIP骑行卡：**

* 不属于银行卡（无身份信息）
* 免费租车
* 使用App无计费、无提醒、无推送
* 绑卡页面字段：骑行卡号

---

### 计费说明（新增：V1.5）

日租固定计费，时租梯度计费。

---

### 用户App

#### 地图－附近站点（更新：V1.1）

**请求参数：**

* 用户id（可空）
* 用户当前位置
* 范围半径

**响应参数：**

* 范围内的站点坐标
* 每个站点的名称
* 每个站点的编号
* 每个站点的可借车辆数
* 每个站点的可还锁桩数
* 每个站点的站点状态（充足、紧缺、无可用）。

**备注：**站点状态根据用户借车状态、可借车辆数、可还锁桩数判断。未借车时返回状态根据可借车辆数判断，可借车辆数大于等于总量50%为充足，可借车辆数小于总量50%且大于0为紧缺，可借车辆数等于0为无可用；借车时返回状态根据可还锁桩数判断，可还锁桩数大于等于总量50%为充足，可还锁桩数小于总量50%且大于0为紧缺，可还锁桩数等于0为无可用。**这里的50%可能会改动。**

---

#### 登录（更新：V1.3）

**请求参数：**

* 手机号
* 密码

**响应参数：**

* 用户id

---

#### 获取用户信息（更新：V1.6）

**请求参数：**

* 用户id

**响应参数：**

* 昵称（可空）
* 头像（可空）
* 手机号（注册账号时的手机号）
* 骑行卡号（可空）
* 骑行卡余额（可空）
* 保证金（可空）

**备注：**如果是新注册未绑卡用户，返回值如下：昵称（新用户＋id号）、头像（空）、手机号（注册账号时的手机号）、骑行卡号（未绑定）、骑行卡余额（0）、保证金（0）。如果是新注册已绑卡用户，返回值如下：昵称（新用户＋id号）、头像（空）、手机号（注册账号时的手机号）、骑行卡号（卡号）、骑行卡余额（实际金额）、保证金（实际金额）。

---

#### 获取验证码

**请求参数：**

* 手机号

**响应参数：**

* 短信验证码

---

#### 注册

**请求参数：**

* 手机号
* 密码
* 短信验证码

**响应参数：**

* 无

---

#### 找回密码

**请求参数：**

* 手机号
* 密码
* 短信验证码

**响应参数：**

* 无

---

#### 绑定骑行卡（更新：V1.4）

**请求参数：**

* 用户id
* 卡类型（普通骑行卡、VIP骑行卡）
* 手机号（可空，办理骑行卡时的预留手机号）
* 短信验证码（可空）
* 骑行卡号
* 真实姓名（可空）
* 身份证号（可空）

**响应参数：**

* 无
* 卡类型

**备注：****VIP骑行卡绑定只需要填写骑行卡号，后台需要判断用户当前卡类型。**办理骑行卡时的预留手机号，可与注册手机号不一致，App个人中心需要展示的手机号为办理骑行卡时的预留手机号。**一个骑行卡号对应一个登录帐号，绑定骑行卡后登录帐号做一个标记，再用新的登录帐号绑定该骑行卡不允许。**

---

#### 报修－故障提交（可通用）

**请求参数：**

* 用户id
* 车辆编号或锁桩编号或站点编号，根据故障类型填写相应编号
* 故障类型
* 故障照片（暂定一张）
* 故障描述

**响应参数：**

* 无

---

#### 地图－借车时间（更新：V1.2）

**请求参数：**

* 用户id

**响应参数：**

* 是否为借车状态（已借车或未借车）
* 借车时间（可空，时间格式为“01:23”、“1天”）

**备注：**根据骑行卡号获取借车状态，如果已借车返回借车时间。

---

#### 租车－扫码租车（更新：V1.2）

**请求参数：**

* 用户id
* 租车code
* 租用方式

**响应参数：**

* 站点名称
* 锁桩编号
* 车辆编号
* 单价

**备注：**响应参数可能会变化。

---

#### 租车－开始租车（新增：V1.2）

**请求参数：**

* 用户id
* 租车code
* 租用方式

**响应参数：**

* 无

---

#### 出行－收入明细（更新：V1.2）

**请求参数：**

* 用户id
* 页数
* 每页显示数据的条数

**响应参数：**

* 时间（格式：“2016-10-14 13:23”）
* 金额

**备注：**默认每10条数据分页处理。

---

#### 出行－支出明细（更新：V1.2）

**请求参数：**

* 用户id
* 页数
* 每页显示数据的条数

**响应参数：**

* 时间（格式：“2016-10-14 13:23”）
* 金额
* 租用方式
* 租用时间
* 借车站点
* 还车站点

**备注：**默认每10条数据分页处理。

---

#### 个人中心－修改昵称（更新：V1.2）

**请求参数：**

* 用户id
* 昵称

**响应参数：**

* 无

---

#### 个人中心－上传头像（更新：V1.2）

**请求参数：**

* 用户id
* 照片

**响应参数：**

* 无

---

#### 个人中心－设置－在线客服（更新：V1.2）

**请求参数：**

* 用户id
* 反馈内容

**响应参数：**

* 无

---

#### 消息－消息列表（更新：V1.2）

**请求参数：**

* 用户id

**响应参数：**

* 当前消息类型
* 每种类型消息的第一条消息的内容
* 每种类型消息的第一条消息的时间（当天时间格式为“xx分钟前”或“xx小时前”，非当天时间格式为“2016-10-14”）

**消息类型：**

* 系统消息（办卡优惠活动消息、广告消息）
* 客服消息（客服答复消息）
* 用车消息（借车成功、还车成功、计费提醒、超时提醒）
* 故障奖励（故障反馈奖励消息）

>计费提醒:即将结束免费时段（即将满1小时前10分钟提醒）
>
>超时提醒:即将超过1天（即将满24小时前1小时提醒）

**备注：**未登录或未绑卡用户可收到与卡无关的消息（如优惠活动），绑卡用户可收到与卡相关的消息（如借车提醒）。

---

#### 消息－消息详情（更新：V1.2）

**请求参数：**

* 用户id
* 消息类型
* 页数
* 每页显示消息的条数

**响应参数：**

* 每条消息的内容（限制100字以内）
* 每条消息的时间（当天时间格式为“xx分钟前”或“xx小时前”，非当天时间格式为“2016-10-14”）

**备注：**未登录或未绑卡用户可查看与卡无关的消息详情（如优惠活动），绑卡用户可查看与卡相关的消息详情（如借车提醒）。默认每10条消息分页处理。

---

### 员工App

#### 登录

**请求参数：**

* 账号
* 密码

**响应参数：**

* 员工类型（共四种：调度人员、巡检人员、维修人员、管理人员）
* 员工姓名
* 员工工号
* 所在公司

---

#### 状态修改（调度、巡检通用，更新：V1.4）

**请求参数：**

* 任务id
* 任务类型
* 目标状态
* 员工工号

**响应参数：**

* 任务状态

**备注：**维修人员五种状态（待开始、进行中、调度中、在维修点、已完成），巡检人员四种状态（待开始、进行中、已驳回、已完成），调度人员三种状态（待开始、进行中、已完成）。

---

#### 调度人员－任务列表（更新：V1.3）

**请求参数：**

* 员工工号
* 页数
* 每页显示数据的条数

**响应参数：**

* 任务id
* 任务类型（后台调度人员指派任务、App维修人员指派任务）
* 站点类型（调出站点、调入站点、维修车辆所在站点）
* 站点名称
* 任务状态（待开始、进行中）
* 应调车辆数（维修人员应调车辆数为1）

**备注：**默认每10条数据分页处理。

---

#### 调度人员－任务详情－调出调入（后台指派任务，更新：V1.3）

**请求参数：**

* 任务id

**响应参数：**

* 站点类型
* 站点名称（调出站点或调入站点）
* 站点编号
* 应调车辆数
* 要求开始时间
* 要求结束时间
* 任务状态（待开始、进行中）

---

#### 调度人员－任务详情－维修点（App指派任务，更新：V1.3）

**请求参数：**

* 任务id

**响应参数：**

* 站点名称（维修车辆所在站点）
* 站点编号
* 提交者的姓名（维修人员姓名）
* 照片（从维修人员任务中获取，维修人员通过巡检人员获取，巡检人员通过自己拍摄获取或从调度人员和用户提交的故障信息中获取）
* 车辆编号（同照片获取逻辑）
* 故障描述（同照片获取逻辑）
* 任务状态（待开始、进行中、调度中、在维修点）

---

#### 调度人员－任务详情－调出调入－确认完成（更新：V1.3）

**请求参数：**

* 员工工号
* 任务id
* 任务完成情况（可空）

**响应参数：**

* 实际调度车辆数（调度卡应该能获取此信息）

**备注：**需要硬件交互，通过员工工号查询员工所用的调度卡信息来判断调度任务完成情况。**从调度卡读取到的任务完成情况可能与当前页面任务不对应，需要和当前页面任务比较吗？还是以调度卡任务完成情况为最终的任务完成情况？**和客户讨论的结果是以调度卡任务完成情况为最终的任务完成情况，但是需要怎么处理不至于使任务记录混乱需要考虑到。**调度人员在调度车的时候，柱桩先去后台请求是否允许调度，根据后台的返回结果决定是否开锁（允许调度）**

---

#### 调度人员－任务详情－维修点－确认完成（更新：V1.3）

**请求参数：**

* 员工工号
* 任务id
* 任务完成情况（可空）

**响应参数：**

* 实际调度车辆数（调度卡应该能获取此信息）

**备注：**需要硬件交互，通过员工工号查询员工所用的调度卡信息来判断调度任务完成情况。**从调度卡读取到的任务完成情况可能与当前页面任务不对应，需要和当前页面任务比较吗？还是以调度卡任务完成情况为最终的任务完成情况？**和客户讨论的结果是以调度卡任务完成情况为最终的任务完成情况，但是需要怎么处理不至于使任务记录混乱需要考虑到。**调度人员在调度车的时候，柱桩先去后台请求是否允许调度，根据后台的返回结果决定是否开锁（允许调度）**

---

#### 调度人员－故障提交（可通用）

**请求参数：**

* 员工工号
* 车辆编号或锁桩编号或站点编号，根据故障类型填写相应编号
* 故障类型
* 故障照片（暂定一张）
* 故障描述

**响应参数：**

* 无

---

#### 巡检人员－任务列表（更新：V1.3）

**请求参数：**

* 员工类型
* 员工工号
* 页数
* 每页显示数据的条数

**响应参数：**

* 任务id
* 故障地点
* 故障类型
* 任务状态（待开始、进行中）

**备注：**默认每10条数据分页处理。用户和调度人员提交的故障客服审核通过后显示在这里。

---

#### 巡检人员－任务详情（更新：V1.3）

**请求参数：**

* 任务id

**响应参数：**

* 故障类型
* 站点地点
* 站点编号
* 车辆编号或锁桩编号或站点编号
* 故障照片
* 故障描述
* 任务状态（待开始、进行中）

---

#### 巡检人员－任务详情－驳回（更新：V1.3）

使用“状态修改（通用）”接口。

---

#### 巡检人员－任务详情－故障确认（更新：V1.3）

使用“状态修改（通用）”接口。

**备注：**用户故障提交时上传了骑行卡号，故障确认存在后，根据后台设置的奖励规则，奖励现金发放到用户骑行卡中。而且，故障确认后的信息显示到维修人员任务列表。

---

#### 巡检人员－故障提交（可通用）

**请求参数：**

* 员工工号
* 车辆编号或锁桩编号或站点编号，根据故障类型填写相应编号
* 故障类型
* 故障照片（暂定一张）
* 故障描述

**响应参数：**

* 无

**备注：**巡检人员提交的故障显示到维修人员任务列表。

---

#### 维修人员－任务列表（更新：V1.3）

**请求参数：**

* 员工工号
* 页数
* 每页显示数据的条数

**响应参数：**

* 任务id
* 故障地点
* 故障类型
* 任务状态（待开始、进行中、调度中、在维修点）

**备注：**默认每10条数据分页处理。

---

#### 维修人员－任务详情（更新：V1.3）

**请求参数：**

* 任务id

**响应参数：**

* 故障类型
* 故障地点
* 站点编号
* 提交者（巡检人员的姓名）
* 车辆编号或锁桩编号或站点编号
* 故障照片
* 故障描述
* 维修方式
* 任务状态

---

#### 维修人员－任务详情－确认完成（更新：V1.4）

不可使用“状态修改（通用）”接口。

**请求参数：**

* 任务id
* 目标状态
* 员工工号
* 维修方式
* 维修确认照片

**响应参数：**

* 任务状态

**备注：**维修方式选择送至维修点，不需维修确认照片，确认按钮功能为提醒调度员把车辆送至维修点，任务状态为进行中；维修人员回到维修点修好车辆后，再次点击确认按钮提醒调度员把车辆送回站点，任务状态为已完成。维修方式选择现场维修，需维修确认照片，点击确认按钮后任务状态为已完成。

---

#### 管理人员－任务列表（更新：V1.4）

**管理人员查看任务流程结束后的信息，包括以下情况：**

* 调度任务：后台下发的调度任务已完成
* 巡检任务：巡检故障信息已驳回
* 维修任务：巡检故障信息已确认，维修现场已维修
* 维修任务：巡检故障信息已确认，维修选择送至维修点，故障车辆送回维修点，在维修点已维修

**请求参数：**

* 员工工号
* 页数
* 每页显示数据的条数

**响应参数：**

* 任务id
* 任务类型（调度任务、巡检任务、维修任务）
* 站点类型（调出站点、调入站点、维修车辆所在站点）
* 应调车辆数（可空，调度任务有此字段）
* 站点名称
* 故障类型（可空，巡检任务有此字段）
* 任务状态（已评价、未评价）

---

#### 管理人员－任务详情－调度（更新：V1.4）

**请求参数：**

* 任务id

**响应参数：**

* 站点类型（调出站点、调入站点）
* 站点名称（调出站点或调入站点）
* 站点编号
* 调度员姓名
* 应调车辆数
* 实调车辆数（调度卡获取此信息）
* 实际调度每个车辆的编号（调度卡获取此信息）
* 要求开始时间
* 要求结束时间
* 实际开始时间（调度卡获取此信息）
* 实际结束时间（调度卡获取此信息）
* 任务状态（已完成）

**任务情景：**后台下发的调度任务已完成。

---

#### 管理人员－任务详情－巡检（更新：V1.4）

**请求参数：**

* 任务id

**响应参数：**

* 故障类型
* 站点地点
* 站点编号
* 巡检员姓名
* 车辆编号或锁桩编号或站点编号
* 故障照片
* 故障描述
* 任务状态（已驳回）

**任务情景：**巡检故障信息已驳回。

---

#### 管理人员－任务详情－维修（更新：V1.4）

**请求参数：**

* 任务id

**响应参数：**

* 故障类型
* 站点地点
* 站点编号
* 巡检员姓名
* 维修员姓名
* 车辆编号或锁桩编号或站点编号
* 故障照片
* 故障描述
* 任务状态（已完成）
* 维修方式
* 维修确认照片

**任务情景：**巡检故障信息已确认，维修现场已维修。

---

#### 管理人员－任务详情－维修（更新：V1.4）

**请求参数：**

* 任务id

**响应参数：**

* 故障类型
* 站点地点
* 站点编号
* 巡检员姓名
* 维修员姓名
* 调度员姓名
* 车辆编号或锁桩编号或站点编号
* 故障照片
* 故障描述
* 任务状态（已完成）
* 维修方式
* 维修确认照片

**任务情景：**巡检故障信息已确认，维修选择送至维修点，故障车辆送回维修点，在维修点已维修。

---

#### 管理人员－任务详情－确认完成（通用，更新：V1.3）

**请求参数：**

* 任务id
* 员工工号（管理人员的工号）
* 管理人员确认照片（暂定一张）
* 管理人员任务评价
* 管理人员任务评分

**响应参数：**

* 无

**备注：**确认后后台只是做记录，不需要通知其他员工。